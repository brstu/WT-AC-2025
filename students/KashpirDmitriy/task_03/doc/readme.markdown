# Отчёт по лабораторной работе № 03

**Асинхронность и HTTP‑кэш (fetch, AbortController, ретраи)**  
**Вариант 34 — Справочник растений**

Автор: Кашпир Дмитрий Русланович
Дата сдачи: 17 ноября 2025  

## 1. Цель работы

Закрепить навыки работы с асинхронным кодом (async/await, промисы), реализовать:

- Повторные попытки (retry) с экспоненциальным backoff
- Таймауты и отмену запросов (AbortController)
- Клиентское кэширование с TTL
- Дебаунс ввода и отмену устаревших запросов
- Состояния loading / error / empty + skeleton‑загрузчик
- Кнопку «Обновить» (игнорирование кэша)

---

### 2. Используемый API

- Основной: **Treffle.com** — `https://trefle.io`  
  Параметры: `key`, `q` (поиск), `page` (пагинация)
- Запросы идут через публичный CORS‑прокси `https://api.codetabs.com/v1/proxy` (обход блокировок в Нидерландах)
- Fallback: при недоступности Perenual — JSONPlaceholder + локальный mock (json‑server)  
  (соответствует методичке — mock‑API разрешён)

### 3. Структура проекта

plant-catalog/
├── index.html
├── main.js          ← основной код
├── api.js           ← fetchWithRetry + AbortController
├── cache.js         ← in‑memory кэш с TTL
├── style.css        ← адаптивный дизайн + skeleton
└── db.json          ← локальный mock (для json-server)

## Реализованные функции

| Функция                              | Реализация                                           | Выполнено |
|--------------------------------------|-------------------------------------------------------|-----------|
| async/await + try/catch/finally      | `loadPlants()`                                        | Yes       |
| Ретраи + экспоненциальный backoff   | `fetchWithRetry` (3 попытки, 600 мс × 2ⁿ)            | Yes       |
| Таймаут запроса                      | AbortController + setTimeout (8 сек)                 | Yes       |
| Отмена предыдущих запросов           | Глобальный `lastController.abort()`                  | Yes       |
| Дебаунс ввода                        | 500 мс                                                | Yes       |
| Кэширование                          | `Map` + TTL 10 минут, ключ `${query}_page_${page}`   | Yes       |
| Кнопка «Обновить» (игнор кэша)       | `loadPlants(..., false)`                              | Yes       |
| Состояния loading / error / empty    | Skeleton, сообщения                                   | Yes       |
| Пагинация                            | Кнопки «Назад/Вперёд», расчёт страниц                | Yes       |
| Не блокирует UI                      | Всё асинхронно + skeleton‑анимация                   | Yes       |

**Бонусы реализованы:**

- Дебаунс + отмена устаревших запросов
- Fallback‑механизм при недоступности внешнего API
- Локальный mock через json-server
