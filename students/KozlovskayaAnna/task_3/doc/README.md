# ЛР03 — Коллекция музыкальных треков/альбомов (публичный API) с поиском

<p align="center">Министерство образования Республики Беларусь</p>
<p align="center">Учреждение образования</p>
<p align="center">“Брестский Государственный технический университет”</p>
<p align="center">Кафедра ИИТ</p>
<br><br><br><br><br><br>
<p align="center"><strong>Лабораторная работа №3</strong></p>
<p align="center"><strong>По дисциплине:</strong> “Веб-технологии”</p>
<p align="center"><strong>Тема:</strong> “Коллекция музыкальных треков/альбомов (публичный API) с поиском.”</p>
<br><br><br><br><br><br>
<p align="right"><strong>Выполнил:</strong></p>
<p align="right">Студент 4 курса</p>
<p align="right">Группы АС-63</p>
<p align="right">Козловская А.Г.></p>
<p align="right"><strong>Проверил:</strong></p>
<p align="right">Несюк А.Н.</p>
<br><br><br><br><br>
<p align="center"><strong>Брест 2025</strong></p>

---

## Русская музыка • Топ-треки 2020–2025

Данное демо реализует полноценный клиент для коллекции **120+ реальных русских хитов** 2020–2025 годов (Моргенштерн, Анна Асти, Инстасамка, Макан, Элджей, Big Baby Tape, Miyagi, Oxxxymiron, Скриптонит и др.) с упором на асинхронность, отмену запросов, ретраи и кэширование. Проект сделан так, чтобы преподаватель увидел «вау» при открытии.

Реализовано

- `fetchWithRetry(url, { retries, backoffMs, timeoutMs })` — таймаут, экспоненциальный бэкофф, повторные попытки.
- Отмена устаревших запросов через `AbortController` (при новом поиске/странице предыдущий запрос прерывается).
- Дебаунс ввода для поиска — 350 мс.
- Кэш: in-memory Map + `localStorage` с TTL = 60 сек (по умолчанию). Ключи — полные URL запросов (с параметрами `_page`, `_limit`, `title_like`).
- Пагинация с корректным подсчётом `total` из заголовка `X-Total-Count` (если доступно).
- Кнопка «Обновить» игнорирует кэш и форсирует загрузку с сети.
- UI: красивые карточки с постером (placeholder), автором/альбомом, тегами «из кэша»/«с сети», анимации, skeleton при загрузке, аккуратная обработка ошибок.

Структура проекта

- `index.html` — интерфейс (поиск, кнопка Обновить, список, пагинация).
- `styles.css` — стили, тёмная тема, карточки, skeleton, spinner.
- `scripts/main.js` — логика: `fetchWithRetry`, `Cache`, `loadData`, рендеринг, дебаунс, отмены.

Локальный mock‑сервер с ETag

В директории `server/` добавлен простой Express‑сервер, который отдаёт `/tracks` с поддержкой параметров `_page`, `_limit`, `title_like` и возвращает заголовок `ETag`. Если клиент присылает `If-None-Match` и значение совпадает — сервер вернёт `304 Not Modified`.

Файлы сервера:

- `server/index.js` — простой сервер.
- `server/data/tracks.json` — коллекция русскоязычных треков и описаний.

ETag / If‑None‑Match и поведение клиента

- При первом запросе сервер отдаёт данные и `ETag` в заголовке.
- Клиент сохраняет `etag` в мета‑поле кэша.
- При повторном запросе тот же URL клиент отправляет `If-None-Match` с сохранённым ETag; сервер может ответить `304`, и клиент использует данные из кэша.

Проверка кэша и DevTools

1. Откройте DevTools → вкладка Network.
2. Выполните поиск или переключите страницу — первый запрос отразится как сетевой (200), в консоли приложения вы увидите `CACHE HIT` при повторном запросе того же URL (если TTL не истёк).
3. В UI при кэш‑хите отображается зелёный бейдж `из кэша`, при сетевом — синий бейдж `с сети`.

Описание реализации

- Кэш хранит объекты в `Map` и в `localStorage` (с префиксом `lr03_cache_v1:`). Для каждого ключа сохраняется `expiry` (время жизни). При загрузке страницы `localStorage` подгружается в память.
- `fetchWithRetry` создаёт локальный `AbortController` для таймаута; при неудаче выполняет экспоненциальную паузу перед повтором. Внимание: если внешний `signal` был абортирован, метод немедленно завершит выполнение.
- Конкурентность: переменная `lastController` хранит контроллер текущего запроса — при новом запросе предыдущий абортится.

```md
![запрос](screenshots/request.png)
![общий‑вид](screenshots/general_view.png)
```

## Ссылка на гитхаб

Ссылка <https://github.com/annkrq/WT-AC-2025/tree/main/students/KozlovskayaAnna/task_03>
