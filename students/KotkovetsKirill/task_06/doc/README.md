# Лабораторная работа №6

<p align="center">Министерство образования Республики Беларусь</p>
<p align="center">Учреждение образования</p>
<p align="center">"Брестский Государственный технический университет"</p>
<p align="center">Кафедра ИИТ</p>
<br><br><br><br><br><br>
<p align="center"><strong>Лабораторная работа №6</strong></p>
<p align="center"><strong>По дисциплине:</strong> "Веб-технологии"</p>
<p align="center"><strong>Тема:</strong> "Базы данных и авторизация (SQLite + ORM + JWT)"</p>
<br><br><br><br><br><br>
<p align="right"><strong>Выполнил:</strong></p>
<p align="right">Студент 4 курса</p>
<p align="right">Группы АС-64</p>
<p align="right">Котковец К. В.</p>
<p align="right"><strong>Проверил:</strong></p>
<p align="right">Несюк А. Н.</p>
<br><br><br><br><br>
<p align="center"><strong>Брест 2025</strong></p>

---

## Цель работы

Настроить ORM и схему данных, реализовать регистрацию/логин с выдачей JWT, middleware защиты и доступ к данным только для владельца. Перенести CRUD из ЛР‑05 в БД.

---

### Вариант №35

**Тема:** Дневник здоровья: измерения, цели, приватность, роли.

## Ход выполнения работы

### 1. Структура проекта

```
src/
├── index.js          - основной файл сервера
├── package.json      - зависимости проекта
├── .env              - переменные окружения
├── .env.example      - пример файла окружения
├── seed.js           - заполнение тестовыми данными
└── prisma/
    └── schema.prisma - схема базы данных
```

### 2. Реализованные элементы

**ORM и База данных:**
- Использован Prisma ORM с SQLite
- Созданы модели User и HealthRecord
- Реализована связь через ownerId

**Авторизация:**
- Регистрация пользователя (`POST /api/auth/signup`)
- Вход в систему (`POST /api/auth/login`)
- JWT токены для аутентификации
- Хеширование паролей с bcrypt

**CRUD операции:**
- Получение всех записей пользователя (`GET /api/records`)
- Создание записи (`POST /api/records`)
- Получение одной записи (`GET /api/records/:id`)
- Обновление записи (`PUT /api/records/:id`)
- Удаление записи (`DELETE /api/records/:id`)

**Безопасность:**
- CORS настроен
- Middleware для проверки JWT токена
- Хранение секретов в .env

### 3. Инструкция по запуску

1. Установить зависимости:

```bash
npm install
```

1. Настроить .env файл (скопировать из .env.example)

1. Создать базу данных:

```bash
npx prisma generate
npx prisma db push
```

1. Заполнить тестовыми данными:

```bash
npm run seed
```

1. Запустить сервер:

```bash
npm start
```

Сервер запустится на `http://localhost:3000`

### 4. API Эндпоинты

**Регистрация:**

```
POST /api/auth/signup
Body: { "email": "user@test.com", "password": "123456", "name": "Имя" }
```

**Вход:**

```
POST /api/auth/login
Body: { "email": "user@test.com", "password": "123456" }
Response: { "token": "...", "user": {...} }
```

**Получить все записи (требуется токен):**

```
GET /api/records
Headers: Authorization: Bearer <token>
```

**Создать запись:**

```
POST /api/records
Headers: Authorization: Bearer <token>
Body: {
  "type": "Давление",
  "value": "120/80",
  "date": "2025-12-16",
  "goal": "Нормализовать",
  "notes": "Примечания"
}
```

**Получить запись:**

```
GET /api/records/:id
Headers: Authorization: Bearer <token>
```

**Обновить запись:**

```
PUT /api/records/:id
Headers: Authorization: Bearer <token>
Body: { "value": "130/85" }
```

**Удалить запись:**

```
DELETE /api/records/:id
Headers: Authorization: Bearer <token>
```

### 5. Скриншоты выполненной лабораторной работы

![Регистрация пользователя](https://via.placeholder.com/800x600/667eea/ffffff?text=Регистрация+пользователя)
*Регистрация нового пользователя в системе*

![Вход в систему](https://via.placeholder.com/800x600/764ba2/ffffff?text=Вход+в+систему)
*Получение JWT токена при входе*

![Создание записи](https://via.placeholder.com/800x600/10b981/ffffff?text=Создание+записи+о+здоровье)
*Создание записи о здоровье*

![Список записей](https://via.placeholder.com/800x600/3b82f6/ffffff?text=Список+записей+о+здоровье)
*Получение списка всех записей пользователя*

---

## Таблица критериев

| Критерий                                | Выполнено |
|------------------------------------------|-----------|
| Схема БД/миграции                        | ✅ |
| CRUD + связь с пользователем             | ✅ |
| Безопасность (хеши, JWT, защита маршрутов, CORS) | ✅ |
| Качество кода/архитектуры                | ✅ |
| Тесты/валидность                         | ❌ |
| Документация/инструкция                  | ✅ |

### Дополнительные бонусы

| Бонус                                     | Выполнено |
|-------------------------------------------|-----------|
| Refresh‑токены и обновление access‑токена | ❌ |
| Роли/права (admin/user)                   | ❌ |
| Password reset flow                       | ❌ |

---

## Вывод

В ходе выполнения работы было создано серверное приложение на Node.js с использованием Express, Prisma ORM и SQLite. Реализована система авторизации на основе JWT токенов с хешированием паролей. Все CRUD операции для записей дневника здоровья работают с базой данных и защищены авторизацией. Настроены CORS и переменные окружения для безопасного хранения секретов.
