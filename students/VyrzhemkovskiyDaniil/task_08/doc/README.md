# Лабораторная работа №8: Качество и деплой трекера задач

## Цель работы

Настроить качество проекта: тесты, контейнеризация, CI/CD и проверка качества через Lighthouse. Реализовать полный цикл разработки от тестирования до деплоя веб-приложения для управления задачами.

## Вариант №2: "Трекер задач"

## Ход выполнения работы

### 1. Структура проекта

```bash
task_08/
├── .github/workflows/ci.yml         # GitHub Actions workflow для CI/CD
├── cypress/
│   └── e2e/tasks_spec.js           # E2E тесты Cypress
├── cypress.config.js                # Конфигурация Cypress
├── docker-compose.yml               # Docker Compose конфигурация
├── Dockerfile                       # Многостадийный Dockerfile
├── jest.setup.js                    # Настройка тестового окружения
├── package.json                     # Зависимости и скрипты проекта
├── server.js                        # Express сервер с REST API
├── public/
│   └── index.html                   # HTML шаблон приложения
├── src/
│   ├── api.js                       # API клиент для работы с задачами
│   ├── app.js                       # Клиентское приложение на vanilla JS
│   ├── index.js                     # Главный клиентский JavaScript код
│   └── TaskCard.js                  # Компонент карточки задачи
├── tests/
│   ├── api.test.js                  # Unit тесты API сервера
│   └── TaskCard.test.js             # Unit тесты компонента TaskCard
└── README.md                        # Документация проекта
```

### 2. Основные технологии и библиотеки

- **Node.js + Express** — серверная часть приложения с REST API
- **Vanilla JavaScript** — клиентская часть без фреймворков
- **Jest** — unit и integration тестирование
- **Cypress** — E2E тестирование пользовательских сценариев
- **Docker + Docker Compose** — контейнеризация приложения
- **GitHub Actions** — автоматизированный CI/CD пайплайн
- **ESLint** — проверка качества кода
- **Supertest** — тестирование HTTP endpoints

### 3. Функциональность приложения

#### 3.1. Основные возможности

- **Создание задач** — добавление новых задач с заголовком, описанием, сроком выполнения и приоритетом
- **Управление задачами** — редактирование, удаление, пометка как выполненной
- **Фильтрация задач** — просмотр всех, только выполненных или только ожидающих задач
- **Статистика** — отображение общего количества задач, выполненных и ожидающих
- **Приоритеты задач** — три уровня приоритета: низкий, средний, высокий
- **Адаптивный интерфейс** — корректное отображение на разных устройствах

#### 3.2. API Endpoints

- `GET /api/health` — проверка работоспособности сервера
- `GET /api/tasks` — получение списка всех задач (с фильтрацией по статусу и приоритету)
- `GET /api/tasks/:id` — получение конкретной задачи по ID
- `POST /api/tasks` — создание новой задачи
- `PUT /api/tasks/:id` — полное обновление задачи
- `PATCH /api/tasks/:id/toggle` — переключение статуса выполнения задачи
- `DELETE /api/tasks/:id` — удаление задачи
- `GET /api/stats` — получение статистики по задачам

#### 3.3. Состояния интерфейса

- **Загрузка** — индикатор прогресса при загрузке данных с сервера
- **Пустое состояние** — сообщение при отсутствии задач или результатов фильтрации
- **Ошибка** — уведомление о проблемах с сетью или сервером
- **Интерактивные элементы** — кнопки с визуальной обратной связью

### 4. Тестирование

#### 4.1. Unit тесты (Jest)

- **Тесты API сервера** — проверка всех REST endpoints (8 тестов)
  - Создание, чтение, обновление, удаление задач
  - Фильтрация и статистика
  - Обработка ошибок
- **Тесты компонентов** — тестирование класса TaskCard (8 тестов)
  - Рендеринг HTML
  - Обработка разных состояний задачи
  - Форматирование данных
- **Покрытие кода** — более 80% покрытия по всем критериям

#### 4.2. E2E тесты (Cypress)

- **Загрузка страницы** — проверка отображения основных элементов интерфейса
- **Работа с задачами** — тестирование полного цикла CRUD операций
- **Фильтрация** — проверка работы фильтров по статусу задач
- **Статистика** — тестирование обновления счетчиков в реальном времени
- **Адаптивность** — проверка корректного отображения на разных разрешениях экрана
- **Валидация форм** — тестирование обязательных полей

### 5. Контейнеризация

#### 5.1. Docker

- **Многостадийная сборка** — использование двух этапов для оптимизации размера образа
- **Alpine базовый образ** — минимальный размер итогового контейнера (~100MB)
- **Health checks** — автоматическая проверка работоспособности приложения
- **Non-root пользователь** — запуск приложения с ограниченными правами для безопасности
- **Производственная конфигурация** — оптимизация для production среды

#### 5.2. Docker Compose

- **Упрощенный запуск** — однокомандный запуск всего приложения: `docker-compose up`
- **Автоматический перезапуск** — устойчивость к сбоям, автоматическое восстановление
- **Конфигурация окружения** — централизованное управление переменными среды
- **Изолированная сеть** — безопасная сетевая конфигурация
- **Монтирование томов** — сохранение данных и статических файлов

### 6. CI/CD пайплайн

#### 6.1. GitHub Actions workflow

Рабочий процесс состоит из четырех параллельных джобов:

1. **Test Job** — запускается на Node.js 18 и 20
   - Установка зависимостей с кэшированием
   - Линтинг кода с ESLint
   - Запуск unit тестов Jest с проверкой покрытия
   - Загрузка отчета покрытия в Codecov
   - Проверка сборки проекта

2. **E2E Job** — тестирование пользовательских сценариев
   - Запуск development сервера
   - Выполнение Cypress E2E тестов
   - Сохранение скриншотов при падении тестов
   - Запись видео выполнения тестов

3. **Lighthouse Job** — аудит производительности
   - Запуск приложения
   - Выполнение Lighthouse проверок
   - Генерация отчетов в форматах HTML и JSON
   - Проверка ключевых метрик (Performance, Accessibility, SEO)

4. **Build Job** — сборка и тестирование Docker образа
   - Настройка Docker Buildx
   - Сборка production образа
   - Запуск контейнера и проверка работоспособности
   - Интеграционное тестирование API

#### 6.2. Артефакты

- **Отчет о покрытии кода** — автоматическая загрузка в Codecov
- **Скриншоты Cypress** — сохранение при падении E2E тестов
- **Видео тестов** — запись выполнения E2E тестов для отладки
- **Lighthouse отчет** — детальные метрики производительности
- **Результаты тестов** — JUnit формат для интеграции с CI системами

### 7. Качество кода

#### 7.1. Стандарты кодирования

- **ESLint с Airbnb конфигом** — соблюдение лучших практик JavaScript
- **Строгий режим** — использование `'use strict'` во всех файлах
- **Соглашения о именовании** — единый стиль camelCase для переменных и функций
- **Комментарии JSDoc** — документирование классов и методов
- **Обработка ошибок** — централизованная обработка исключений

#### 7.2. Документация

- **Подробный README** — полные инструкции по установке и запуску
- **Комментарии в коде** — объяснение сложных алгоритмов и логики
- **JSDoc документация** — автоматическая генерация документации API
- **Примеры использования** — демонстрация работы с API
- **Структура проекта** — четкая организация файлов и папок

## Запуск проекта

### 1. Локальный запуск (разработка)

```bash
# Установка зависимостей
npm install

# Запуск сервера разработки
npm start

# Запуск в режиме разработки с авто-перезагрузкой
npm run dev
```

### 2. Запуск с Docker

```bash
# Сборка и запуск контейнера
docker-compose up --build

# Или просто запуск (если образ уже собран)
docker-compose up

# Запуск в фоновом режиме
docker-compose up -d
```

### 3. Тестирование

```bash
# Запуск всех тестов
npm test

# Запуск тестов с отслеживанием изменений
npm run test:watch

# Запуск тестов с покрытием кода
npm run test:coverage

# Запуск E2E тестов в CI режиме
npm run e2e:ci

# Открытие Cypress GUI для интерактивного тестирования
npm run e2e
```

### 4. Проверка качества кода

```bash
# Линтинг кода
npm run lint

# Автоматическое исправление ошибок линтинга
npm run lint:fix
```

### 5. Деплой и мониторинг

```bash
# Сборка Docker образа
npm run docker:build

# Запуск Docker контейнера
npm run docker:run

# Проверка работоспособности API
curl http://localhost:3000/api/health
```

## Вывод

В ходе выполнения лабораторной работы №8 был успешно реализован и настроен полный цикл разработки веб-приложения "Трекер задач". Достигнуты следующие результаты:
