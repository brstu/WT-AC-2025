<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NASA APOD Gallery | –õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞—è —Ä–∞–±–æ—Ç–∞ 03</title>
    <meta name="api-key" content="y6hXK61eTxSwPJMOuxVkrJArQpcynRbHif7Glu8A">
    <meta name="description" content="–ì–∞–ª–µ—Ä–µ—è NASA Astronomy Picture of the Day —Å –ª–∏—á–Ω—ã–º API –∫–ª—é—á–æ–º, –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º –∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–º–∏ –∑–∞–ø—Ä–æ—Å–∞–º–∏">
    <link rel="stylesheet" href="styles.css">
    <link rel="manifest" href="manifest.json">
</head>
<body>
    <div class="container">
        <header>
            <h1>üåå NASA Astronomy Picture of the Day</h1>
            <p class="subtitle">–õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞—è —Ä–∞–±–æ—Ç–∞ 03: –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å –∏ HTTP‚Äë–∫—ç—à | –õ–∏—á–Ω—ã–π API –∫–ª—é—á</p>
        </header>

        <div class="api-status-bar" id="api-status-bar">
            <div class="status-item">
                <span class="status-label">API:</span>
                <span class="status-value" id="api-status">–ü—Ä–æ–≤–µ—Ä–∫–∞...</span>
            </div>
            <div class="status-item">
                <span class="status-label">–ó–∞–ø—Ä–æ—Å—ã:</span>
                <span class="status-value" id="request-count">0/1000</span>
            </div>
            <div class="status-item">
                <span class="status-label">–í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞:</span>
               <span class="status-value" id="response-time">0 –º—Å</span>
            </div>
            <div class="status-item">
                <span class="status-label">–ö—ç—à:</span>
                <span class="status-value" id="cache-status-mini">–ê–∫—Ç–∏–≤–µ–Ω</span>
            </div>
        </div>

        <div class="controls">
            <div class="control-group">
                <label for="startDate">–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞:</label>
                <input type="date" id="start-date" aria-label="–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞">
            </div>
            
            <div class="control-group">
                <label for="endDate">–î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è:</label>
                <input type="date" id="end-date" aria-label="–î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è">
            </div>
            
            <div class="control-group">
                <label for="countSelect">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ:</label>
                <select id="count-select" aria-label="–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π">
                    <option value="5">5 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π</option>
                    <option value="10" selected>10 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π</option>
                    <option value="15">15 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π</option>
                    <option value="20">20 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π</option>
                    <option value="30">30 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π</option>
                </select>
            </div>
            
            <div class="buttons-group">
                <button id="load-btn" class="btn-primary">
                    <span class="btn-text">üöÄ –ó–∞–≥—Ä—É–∑–∏—Ç—å</span>
                    <span class="spinner" style="display: none;"></span>
                </button>
                
                <button id="refresh-btn" class="btn-secondary" title="–û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ (–∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å –∫—ç—à)">
                    üîÑ –û–±–Ω–æ–≤–∏—Ç—å
                </button>
                
                <button id="clearCacheBtn" class="btn-secondary" title="–û—á–∏—Å—Ç–∏—Ç—å –≤–µ—Å—å –∫—ç—à">
                    üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –∫—ç—à
                </button>
                
                <button id="toggle-mock-btn" class="btn-secondary" title="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ä–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã API">
                    üîß –†–µ–∂–∏–º API
                </button>
            </div>
        </div>

        <div class="cache-controls">
            <label class="cache-toggle">
                <input type="checkbox" id="cache-toggle" checked>
                <span>–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫—ç—à</span>
            </label>
            <div class="cache-info-mini">
                <span>–ö–ª—é—á: <span id="api-key-status" class="key-status valid">‚úÖ –ê–∫—Ç–∏–≤–µ–Ω</span></span>
                <span>–†–µ–∂–∏–º: <span id="api-mode" class="mode-indicator real">üåê –†–µ–∞–ª—å–Ω—ã–π API</span></span>
            </div>
        </div>

        <div id="status-message" class="status-message" aria-live="polite"></div>

        <main>
            <div id="apod-container" class="apod-grid">
                <!-- –°–∫–µ–ª–µ—Ç–æ–Ω—ã –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ JS -->
            </div>

            <div class="pagination" id="pagination"></div>
        </main>

        <section class="cache-info" aria-labelledby="cacheStatsTitle">
            <h3 id="cache-stats-title">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏</h3>
            <div class="stats-grid">
                <div class="stat-card cache-hit">
                    <div class="stat-value" id="cache-hits">0</div>
                    <div class="stat-label">–ü–æ–ø–∞–¥–∞–Ω–∏—è –≤ –∫—ç—à</div>
                    <div class="stat-desc">–î–∞–Ω–Ω—ã–µ –∏–∑ –ø–∞–º—è—Ç–∏</div>
                </div>
                
                <div class="stat-card cache-miss">
                    <div class="stat-value" id="cache-misses">0</div>
                    <div class="stat-label">–°–µ—Ç–µ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã</div>
                    <div class="stat-desc">–ö NASA API</div>
                </div>
                
                <div class="stat-card cache-size">
                    <div class="stat-value" id="cache-size">0</div>
                    <div class="stat-label">–ó–∞–ø–∏—Å–µ–π –≤ –∫—ç—à–µ</div>
                    <div class="stat-desc">TTL: 24 —á–∞—Å–∞</div>
                </div>
                
                <div class="stat-card performance">
                    <div class="stat-value" id="cache-efficiency">0%</div>
                    <div class="stat-label">–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</div>
                    <div class="stat-desc">–≠–∫–æ–Ω–æ–º–∏—è —Ç—Ä–∞—Ñ–∏–∫–∞</div>
                </div>
            </div>
            
            <div class="api-stats">
                <h4>üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ API –∑–∞–ø—Ä–æ—Å–æ–≤</h4>
                <div class="stats-details">
                    <div class="stat-row">
                        <span>–í—Å–µ–≥–æ –∑–∞–ø—Ä–æ—Å–æ–≤:</span>
                        <span id="total-requests">0</span>
                    </div>
                    <div class="stat-row">
                        <span>–£—Å–ø–µ—à–Ω—ã—Ö:</span>
                        <span id="successful-requests">0</span>
                    </div>
                    <div class="stat-row">
                        <span>–° –æ—à–∏–±–∫–∞–º–∏:</span>
                        <span id="failed-requests">0</span>
                    </div>
                    <div class="stat-row">
                        <span>–°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è:</span>
                        <span id="avg-response-time">0 –º—Å</span>
                    </div>
                    <div class="stat-row">
                        <span>–õ–∏–º–∏—Ç –≤ —á–∞—Å:</span>
                        <span>1000 –∑–∞–ø—Ä–æ—Å–æ–≤</span>
                    </div>
                </div>
            </div>
            
            <div class="cache-details">
                <details>
                    <summary>üîç –î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ä–∞–±–æ—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è</summary>
                    <div class="details-content">
                        <div class="detail-section">
                            <h5>‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ API</h5>
                            <p><strong>–ö–ª—é—á:</strong> <code id="masked-key">y6hX...7Glu8A</code></p>
                            <p><strong>–ë–∞–∑–æ–≤–∞—è —Å—Å—ã–ª–∫–∞:</strong> <code>https://api.nasa.gov/planetary/apod</code></p>
                            <p><strong>–ò–Ω—Ç–µ—Ä–≤–∞–ª –∑–∞–ø—Ä–æ—Å–æ–≤:</strong> 500 –º—Å</p>
                            <p><strong>–¢–∞–π–º–∞—É—Ç:</strong> 10 —Å–µ–∫—É–Ω–¥</p>
                        </div>
                        
                        <div class="detail-section">
                            <h5>üíæ –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ</h5>
                            <p><strong>–¢–∏–ø –∫—ç—à–∞:</strong> In-memory Map + Service Worker</p>
                            <p><strong>–í—Ä–µ–º—è –∂–∏–∑–Ω–∏:</strong> 24 —á–∞—Å–∞ (–∞–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∞)</p>
                            <p><strong>–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä:</strong> 50 –∑–∞–ø–∏—Å–µ–π</p>
                            <p><strong>–°—Ç—Ä–∞—Ç–µ–≥–∏—è:</strong> Cache First –¥–ª—è —Å—Ç–∞—Ç–∏–∫–∏, Network First –¥–ª—è API</p>
                        </div>
                        
                        <div class="detail-section">
                            <h5>üîÑ –†–µ—Ç—Ä–∞–∏ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫</h5>
                            <p><strong>–ü–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏:</strong> 1 (–ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö —Å–µ—Ç–∏)</p>
                            <p><strong>–ó–∞–¥–µ—Ä–∂–∫–∞:</strong> –≠–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è (1000 –º—Å, 2000 –º—Å)</p>
                            <p><strong>–û–±—Ä–∞–±–æ—Ç–∫–∞ 429:</strong> –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø–∞—É–∑–∞ + —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ</p>
                            <p><strong>Fallback:</strong> –ê–≤—Ç–æ–ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ mock –¥–∞–Ω–Ω—ã–µ</p>
                        </div>
                        
                        <div class="action-buttons">
                            <button id="view-cache-btn" class="btn-small">üìÅ –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∫—ç—à</button>
                            <button id="reset-stats-btn" class="btn-small">üîÑ –°–±—Ä–æ—Å–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É</button>
                            <button id="test-api-btn" class="btn-small">üß™ –¢–µ—Å—Ç API</button>
                            <button id="export-stats-btn" class="btn-small">üì§ –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö</button>
                        </div>
                    </div>
                </details>
            </div>
        </section>

        <footer>
            <p>–õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞—è —Ä–∞–±–æ—Ç–∞ 03: –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å –∏ HTTP‚Äë–∫—ç—à | –§–ò–û —Å—Ç—É–¥–µ–Ω—Ç–∞ | –ì—Ä—É–ø–ø–∞</p>
            <p>–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ª–∏—á–Ω—ã–π API –∫–ª—é—á NASA (y6hX...7Glu8A) | –õ–∏–º–∏—Ç: 1000 –∑–∞–ø—Ä–æ—Å–æ–≤/—á–∞—Å</p>
            <p class="tech-info">–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏: JavaScript (ES6+), Fetch API, AbortController, Service Workers, CSS Grid, PWA</p>
            <p class="timestamp" id="page-timestamp">–ó–∞–≥—Ä—É–∂–µ–Ω–æ: <span id="current-time"></span></p>
        </footer>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π -->
    <div id="image-modal" class="modal" role="dialog" aria-labelledby="modal-title" aria-hidden="true">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modal-title">üåå –ü—Ä–æ—Å–º–æ—Ç—Ä –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è NASA</h2>
                <button class="modal-close" aria-label="–ó–∞–∫—Ä—ã—Ç—å" onclick="closeModal()">√ó</button>
            </div>
            <div class="modal-body">
                <div class="image-container">
                    <img id="modal-image" alt="" class="modal-image">
                    <div class="image-loading" id="image-loading">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                </div>
                <div class="image-info">
                    <h3 id="modal-image-title"></h3>
                    <div class="image-meta">
                        <span class="meta-item" id="modal-image-date"></span>
                        <span class="meta-item" id="modal-image-copyright"></span>
                        <span class="meta-item" id="modal-image-type"></span>
                    </div>
                    <p id="modal-image-explanation"></p>
                    <div class="image-actions">
                        <button onclick="downloadImage()" class="btn-small">üíæ –°–∫–∞—á–∞—Ç—å</button>
                        <button onclick="shareImage()" class="btn-small">üì§ –ü–æ–¥–µ–ª–∏—Ç—å—Å—è</button>
                        <a id="image-source-link" href="#" target="_blank" class="btn-small">üîó –ò—Å—Ç–æ—á–Ω–∏–∫</a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- –î–∏–∞–ª–æ–≥ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∫—ç—à–∞ -->
    <dialog id="cache-dialog">
        <div class="dialog-content">
            <h2>üìÇ –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –∫—ç—à–∞</h2>
            <div class="dialog-tabs">
                <button class="tab-btn active" data-tab="memory">üß† In-memory –∫—ç—à</button>
                <button class="tab-btn" data-tab="serviceWorker">‚öôÔ∏è Service Worker</button>
                <button class="tab-btn" data-tab="localStorage">üíæ LocalStorage</button>
            </div>
            
            <div class="tab-content active" id="memory-tab">
                <div id="memory-cache-contents" class="cache-contents">
                    <p class="empty-message">–ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∫—ç—à–∞...</p>
                </div>
            </div>
            
            <div class="tab-content" id="service-worker-tab">
                <div id="sw-cache-contents" class="cache-contents">
                    <p class="empty-message">Service Worker –∫—ç—à –ø—É—Å—Ç –∏–ª–∏ –Ω–µ–∞–∫—Ç–∏–≤–µ–Ω</p>
                </div>
            </div>
            
            <div class="tab-content" id="local-storage-tab">
                <div id="ls-cache-contents" class="cache-contents">
                    <p class="empty-message">–î–∞–Ω–Ω—ã–µ –≤ LocalStorage –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç</p>
                </div>
            </div>
            
            <div class="cache-summary">
                <div class="summary-item">
                    <span>–û–±—â–∏–π —Ä–∞–∑–º–µ—Ä:</span>
                    <span id="total-cache-size">0 KB</span>
                </div>
                <div class="summary-item">
                    <span>–ó–∞–ø–∏—Å–µ–π:</span>
                    <span id="total-cache-items">0</span>
                </div>
                <div class="summary-item">
                    <span>–≠–∫–æ–Ω–æ–º–∏—è —Ç—Ä–∞—Ñ–∏–∫–∞:</span>
                    <span id="traffic-saved">0 KB</span>
                </div>
            </div>
            
            <div class="dialog-actions">
                <button onclick="clearSelectedCache()" class="btn-danger">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–π –∫—ç—à</button>
                <button onclick="document.getElementById('cacheDialog').close()">–ó–∞–∫—Ä—ã—Ç—å</button>
            </div>
        </div>
    </dialog>

    <!-- –î–∏–∞–ª–æ–≥ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è API -->
    <dialog id="api-test-dialog">
        <div class="dialog-content">
            <h2>üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API NASA</h2>
            <div class="test-controls">
                <div class="test-group">
                    <label for="testEndpoint">–≠–Ω–¥–ø–æ–∏–Ω—Ç:</label>
                    <select id="test-endpoint">
                        <option value="apod">APOD (Astronomy Picture of the Day)</option>
                        <option value="count">APOD —Å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º</option>
                        <option value="date">APOD –ø–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –¥–∞—Ç–µ</option>
                        <option value="range">APOD –ø–æ –¥–∏–∞–ø–∞–∑–æ–Ω—É –¥–∞—Ç</option>
                    </select>
                </div>
                
                <div class="test-group" id="test-params">
                    <!-- –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                </div>
                
                <div class="test-group">
                    <label for="testUseCache">–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫—ç—à:</label>
                    <input type="checkbox" id="test-use-cache" checked>
                </div>
            </div>
            
            <div class="test-results">
                <h3>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∞:</h3>
                <div id="test-output" class="test-output">
                    <p>–ù–∞–∂–º–∏—Ç–µ "–ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç" –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ API</p>
                </div>
                
                <div class="test-metrics">
                    <div class="metric">
                        <span>–°—Ç–∞—Ç—É—Å:</span>
                        <span id="test-status">‚Äî</span>
                    </div>
                    <div class="metric">
                        <span>–í—Ä–µ–º—è:</span>
                        <span id="test-time">‚Äî</span>
                    </div>
                    <div class="metric">
                        <span>–†–∞–∑–º–µ—Ä:</span>
                        <span id="test-size">‚Äî</span>
                    </div>
                </div>
            </div>
            
            <div class="dialog-actions">
                <button onclick="runApiTest()" class="btn-primary">üöÄ –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç</button>
                <button onclick="document.getElementById('apiTestDialog').close()">–ó–∞–∫—Ä—ã—Ç—å</button>
            </div>
        </div>
    </dialog>

    <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è -->
    <div id="notification-container" class="notification-container"></div>

    <script src="config.js"></script>
    <script src="api-status.js"></script>
    <script src="mock-api.js"></script>
    <script src="app.js"></script>
    <script>
        // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.getElementById('currentTime').textContent = new Date().toLocaleString('ru-RU');
        
        // –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('service-worker.js')
                    .then(registration => {
                        console.log('‚úÖ Service Worker –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω:', registration.scope);
                        updateSwStatus(true);
                    })
                    .catch(error => {
                        console.log('‚ùå –û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ ServiceWorker:', error);
                        updateSwStatus(false);
                    });
            });
        }
        
        function updateSwStatus(active) {
            const status = document.getElementById('cacheStatusMini');
            if (status) {
                status.textContent = active ? 'SW –ê–∫—Ç–∏–≤–µ–Ω' : 'SW –ù–µ–∞–∫—Ç–∏–≤–µ–Ω';
                status.style.color = active ? '#28a745' : '#dc3545';
            }
        }
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–∞—Å–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–ª—é—á
        document.getElementById('maskedKey').textContent = window.NASA_CONFIG 
            ? window.NASA_CONFIG.maskKey(window.NASA_CONFIG.API_KEY) 
            : 'y6hX...7Glu8A';
    </script>
</body>
</html>