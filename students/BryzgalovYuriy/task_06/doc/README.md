# Лабораторная работа №6

<p align="center">Министерство образования Республики Беларусь</p>
<p align="center">Учреждение образования</p>
<p align="center">"Брестский Государственный технический университет"</p>
<p align="center">Кафедра ИИТ</p>
<br><br><br><br><br><br>
<p align="center"><strong>Лабораторная работа №6</strong></p>
<p align="center"><strong>По дисциплине:</strong> "Веб-технологии"</p>
<p align="center"><strong>Тема:</strong> Базы данных и авторизация (SQLite/PostgreSQL + ORM + JWT)</p>
<br><br><br><br><br><br>
<p align="right"><strong>Выполнил:</strong></p>
<p align="right">Студент 4 курса</p>
<p align="right">Группы АС-64</p>
<p align="right">Брызгалов Ю. Н.</p>
<p align="right"><strong>Проверил:</strong></p>
<p align="right">Несюк А. Н.</p>
<br><br><br><br><br>
<p align="center"><strong>Брест 2025</strong></p>

---

## Цель работы

Подключить базу данных к серверному приложению, настроить ORM и схему данных, реализовать регистрацию и авторизацию пользователей с использованием JWT. Обеспечить защиту маршрутов и доступ к данным только владельцу.

---

### Вариант №26. Мини-социальная сеть (упрощённый вариант)

## Ход выполнения работы

### 1. Структура проекта

```
src/
├── index.js
├── package.json
├── .env.example
├── README.md
└── prisma/
    └── schema.prisma

```

### 2. Реализованные элементы

**База данных:**

- Использована ORM Prisma с SQLite
- Созданы модели User и Trip
- Настроена связь между пользователем и поездками (один-ко-многим)
- Реализована миграция схемы

**Авторизация:**

- Регистрация пользователей `/api/auth/signup`
- Вход в систему `/api/auth/login`
- Выдача JWT токенов
- Middleware для проверки аутентификации
- Хеширование паролей с использованием bcrypt

**CRUD операции для поездок:**

- `GET /api/trips` - получение списка поездок пользователя
- `POST /api/trips` - создание новой поездки
- `GET /api/trips/:id` - получение конкретной поездки
- `PUT /api/trips/:id` - обновление поездки
- `DELETE /api/trips/:id` - удаление поездки

**Безопасность:**

- CORS настроен для защиты от межсайтовых запросов
- Ограничение размера тела запроса
- Токены Bearer для авторизации
- Проверка владельца при доступе к поездкам

**Веб-интерфейс:**

- Простая HTML-страница с формами регистрации/входа
- Отображение списка поездок
- Возможность добавления и удаления поездок

### 3. Скриншоты выполненой лабораторной работы

**Главная страница с формами регистрации и входа:**

![Форма авторизации](https://via.placeholder.com/800x500/4A90E2/FFFFFF?text=%D0%A4%D0%BE%D1%80%D0%BC%D0%B0+%D0%B0%D0%B2%D1%82%D0%BE%D1%80%D0%B8%D0%B7%D0%B0%D1%86%D0%B8%D0%B8)

**Список поездок пользователя:**

![Список поездок](https://via.placeholder.com/800x500/50C878/FFFFFF?text=%D0%A1%D0%BF%D0%B8%D1%81%D0%BE%D0%BA+%D0%BF%D0%BE%D0%B5%D0%B7%D0%B4%D0%BE%D0%BA)

**Добавление новой поездки:**

![Добавление поездки](https://via.placeholder.com/800x500/FF6B6B/FFFFFF?text=%D0%94%D0%BE%D0%B1%D0%B0%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5+%D0%BF%D0%BE%D0%B5%D0%B7%D0%B4%D0%BA%D0%B8)

**Структура базы данных (schema.prisma):**

![Схема БД](https://via.placeholder.com/800x400/9370DB/FFFFFF?text=%D0%A1%D1%85%D0%B5%D0%BC%D0%B0+%D0%B1%D0%B0%D0%B7%D1%8B+%D0%B4%D0%B0%D0%BD%D0%BD%D1%8B%D1%85)

---

## Таблица критериев

| Критерий                                | Баллы | Выполнено |
|------------------------------------------|-------|-----------|
| Схема БД/миграции                       | 20    | ✅ |
| CRUD + связь с пользователем            | 25    | ✅ |
| Безопасность (хеши, JWT, защита маршрутов, CORS) | 20 | ✅ |
| Качество кода/архитектуры               | 15    | ❌ |
| Тесты/валидность                        | 10    | ❌ |
| Документация/инструкция                 | 10    | ✅ |

### Дополнительные бонусы

| Бонус                                     | Баллы | Выполнено |
|-------------------------------------------|-------|-----------|
| Refresh-токены и обновление access-токена | +3    | ❌ |
| Роли/права (admin/user)                   | +4    | ❌ |
| Password reset flow                       | +3    | ❌ |

---

## API Endpoints

### Регистрация

```
POST /api/auth/signup
Content-Type: application/json

{
  "email": "user@example.com",
  "password": "password123",
  "name": "Иван Иванов"
}
```

### Вход

```
POST /api/auth/login
Content-Type: application/json

{
  "email": "user@example.com",
  "password": "password123"
}
```

### Получение токена

После успешной регистрации или входа сервер возвращает:

```json
{
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "userId": 1,
  "name": "Иван Иванов"
}
```

### Работа с поездками

Все запросы требуют заголовок авторизации:

```
Authorization: Bearer YOUR_TOKEN_HERE
```

**Получить все поездки:**

```
GET /api/trips
```

**Создать поездку:**

```
POST /api/trips
Content-Type: application/json

{
  "title": "Поездка в Минск",
  "description": "Деловая поездка",
  "destination": "Минск",
  "startDate": "2025-01-15",
  "endDate": "2025-01-20",
  "budget": 500
}
```

**Получить поездку по ID:**

```
GET /api/trips/1
```

**Обновить поездку:**

```
PUT /api/trips/1
Content-Type: application/json

{
  "title": "Обновленное название",
  "budget": 600
}
```

**Удалить поездку:**

```
DELETE /api/trips/1
```

---

## Инструкция по запуску

### 1. Установка зависимостей

```bash
cd src
npm install
```

### 2. Настройка базы данных

```bash
npx prisma generate
npx prisma migrate dev --name init
```

### 3. Заполнение тестовыми данными (опционально)

```bash
npm run seed
```

Тестовый пользователь:

- Email: <ivan@example.com>
- Пароль: password123

### 4. Запуск сервера

```bash
npm run dev
```

Сервер запустится на <http://localhost:3000>

---

## Вывод

В ходе выполнения лабораторной работы был создан серверный API для планировщика поездок с использованием Node.js, Express, Prisma ORM и SQLite. Реализована система авторизации на основе JWT токенов, хеширование паролей с помощью bcrypt. Настроена схема базы данных с моделями User и Trip, выполнены миграции. Созданы защищенные CRUD endpoints для управления поездками с проверкой владельца. Также реализован простой веб-интерфейс для демонстрации функционала регистрации, входа и работы с поездками.

Освоены навыки работы с ORM, настройки авторизации и защиты маршрутов, работы с JWT токенами.
