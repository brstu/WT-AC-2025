# –û—Ç—á–µ—Ç –ø–æ –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–æ–π —Ä–∞–±–æ—Ç–µ ‚Ññ6

## REST API "Photo Gallery" —Å Prisma –∏ JWT-–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π

**–°—Ç—É–¥–µ–Ω—Ç:** –ö–æ–ª–æ–¥–∏—á –ú–∞–∫—Å–∏–º
**–í–∞—Ä–∏–∞–Ω—Ç:** 9 - –ì–∞–ª–µ—Ä–µ—è —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π —Å –ø—Ä–∏–≤–∞—Ç–Ω—ã–º–∏ –∞–ª—å–±–æ–º–∞–º–∏.

---

## 1. –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–¥–∞–Ω–∏–π

### ‚úÖ –ó–∞–¥–∞–Ω–∏–µ 1: ORM –∏ —Å—Ö–µ–º–∞ –¥–∞–Ω–Ω—ã—Ö

- **ORM:** Prisma (–≤ –ø—Ä–æ–µ–∫—Ç–µ —É–∫–∞–∑–∞–Ω –ø–∞–∫–µ—Ç `prisma` ^5.20.0 –∏ `@prisma/client`)
- **–ë–∞–∑–∞:** –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ —á–µ—Ä–µ–∑ `DATABASE_URL` (–≤ `prisma/schema.prisma` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `postgresql` –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, –≤ `.env.example` —Ç–∞–∫–∂–µ –µ—Å—Ç—å –æ–ø—Ü–∏—è –¥–ª—è SQLite)
- **–ú–æ–¥–µ–ª–∏ (–≤ `prisma/schema.prisma`):**
  - `User` (id, email unique, password, albums, createdAt)
  - `Album` (id, title, ownerId, owner relation, photos, createdAt)
  - `Photo` (id, url, description?, albumId, album relation, createdAt)

### ‚úÖ –ó–∞–¥–∞–Ω–∏–µ 2: –ú–∏–≥—Ä–∞—Ü–∏–∏ –∏ seed

- **–°–∫—Ä–∏–ø—Ç—ã:** –≤ `package.json`:
  - `migrate`: `npx prisma migrate dev`
  - `seed`: `node prisma/seed.js`
- **Seed:** `prisma/seed.js` –¥–æ–±–∞–≤–ª—è–µ—Ç —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è `test@example.com` / `password123` (–ø–∞—Ä–æ–ª—å —Ö–µ—à–∏—Ä—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ `bcryptjs`).

### ‚úÖ –ó–∞–¥–∞–Ω–∏–µ 3: –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ CRUD

- **–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è:** —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –≤ `src/index.js`
  - **POST** `/api/auth/signup` ‚Äî —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è (–≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –∏ `userId`)
  - **POST** `/api/auth/login` ‚Äî –ª–æ–≥–∏–Ω (–≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `token` JWT, —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è 1 —á–∞—Å)
- **–ó–∞—â–∏—â—ë–Ω–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã (—Ç—Ä–µ–±—É—é—Ç `Authorization: Bearer <token>`):**
  - **Albums:**
    - **POST** `/api/albums` ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ –∞–ª—å–±–æ–º–∞
    - **GET** `/api/albums` ‚Äî —Å–ø–∏—Å–æ–∫ –∞–ª—å–±–æ–º–æ–≤ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–≤–∫–ª—é—á–∞—è —Ñ–æ—Ç–æ)
    - **GET** `/api/albums/:id` ‚Äî –ø–æ–ª—É—á–µ–Ω–∏–µ –∞–ª—å–±–æ–º–∞ (–ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –≤–ª–∞–¥–µ–Ω–∏–µ)
    - **PUT** `/api/albums/:id` ‚Äî –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∞–ª—å–±–æ–º–∞ (–ø—Ä–æ–≤–µ—Ä–∫–∞ –≤–ª–∞–¥–µ–ª—å—Ü–∞)
    - **DELETE** `/api/albums/:id` ‚Äî —É–¥–∞–ª–µ–Ω–∏–µ –∞–ª—å–±–æ–º–∞
  - **Photos:**
    - **POST** `/api/albums/:albumId/photos` ‚Äî –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ñ–æ—Ç–æ (url + description)
    - **DELETE** `/api/photos/:id` ‚Äî —É–¥–∞–ª–µ–Ω–∏–µ —Ñ–æ—Ç–æ (–ø—Ä–æ–≤–µ—Ä–∫–∞ –≤–ª–∞–¥–µ–ª—å—Ü–∞ –∞–ª—å–±–æ–º–∞)

### ‚úÖ –ó–∞–¥–∞–Ω–∏–µ 4: –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- CORS –≤–∫–ª—é—á—ë–Ω (`cors`)
- Helmet –¥–ª—è HTTP –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ (`helmet`)
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ body: 1mb (`express.json({ limit: '1mb' })`)
- Rate limiting: 100 req / 15 min (`express-rate-limit`)
- –°–µ–∫—Ä–µ—Ç—ã –≤ `.env` (—Å–º. `.env.example`): `DATABASE_URL`, `JWT_SECRET`

---

## 2. –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –•–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π

- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `bcryptjs` —Å 10 —Ä–∞—É–Ω–¥–∞–º–∏ (`bcrypt.hash(password, 10)` –≤ seed –∏ –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏).

### JWT

- –°–µ–∫—Ä–µ—Ç: `JWT_SECRET` (–≤ `.env`)
- Access token: –ø–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –≤ `/api/auth/login` —Å `expiresIn: '1h'`.

### –í–∞–ª–∏–¥–∞—Ü–∏—è

- –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è (–ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è `email` –∏ `password` –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏/–ª–æ–≥–∏–Ω–µ –∏ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏), –Ω–æ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ Joi/–≤–∞–ª–∏–¥–∞—Ç–æ—Ä—ã –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ —Ç–µ–∫—É—â–µ–π –≤–µ—Ä—Å–∏–∏.

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞

- –í–ª–∞–¥–µ–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –ø–æ `ownerId` –∞–ª—å–±–æ–º–∞ (–Ω–∞ —á—Ç–µ–Ω–∏–µ/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ/—É–¥–∞–ª–µ–Ω–∏–µ –∏ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ —Ñ–æ—Ç–æ).

---

## 3. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
task_06/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îî‚îÄ‚îÄ index.js           # –û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞: auth, albums, photos
‚îú‚îÄ‚îÄ prisma/
‚îÇ   ‚îú‚îÄ‚îÄ schema.prisma      # –°—Ö–µ–º–∞ –ë–î (User, Album, Photo)
‚îÇ   ‚îî‚îÄ‚îÄ seed.js            # Seed (—Ç–µ—Å—Ç–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å)
‚îú‚îÄ‚îÄ .env.example
‚îú‚îÄ‚îÄ package.json
‚îî‚îÄ‚îÄ doc/
    ‚îî‚îÄ‚îÄ README.md          # (—ç—Ç–æ—Ç —Ñ–∞–π–ª)
```

---

## 4. –û—Å–Ω–æ–≤–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

```json
{
  "express": "^4.19.2",
  "prisma": "^5.20.0",
  "@prisma/client": "^5.20.0",
  "bcryptjs": "^2.4.3",
  "jsonwebtoken": "^9.0.2",
  "cors": "^2.8.5",
  "helmet": "^7.1.0",
  "express-rate-limit": "^7.4.0"
}
```

---

## 5. API Endpoints (–∫—Ä–∞—Ç–∫–æ)

### –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

- POST `/api/auth/signup`
  - Request: `{ "email": "user@example.com", "password": "password123" }`
  - Response (201): `{ "message": "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞–Ω", "userId": 1 }`

- POST `/api/auth/login`
  - Request: `{ "email": "test@example.com", "password": "password123" }`
  - Response (200): `{ "token": "eyJ..." }`  (JWT, expiresIn 1h)

### Albums

- POST `/api/albums` ‚Äî create (protected)
- GET `/api/albums` ‚Äî list (protected)
- GET `/api/albums/:id` ‚Äî get (protected, ownership)
- PUT `/api/albums/:id` ‚Äî update (protected, ownership)
- DELETE `/api/albums/:id` ‚Äî delete (protected, ownership)

### Photos

- POST `/api/albums/:albumId/photos` ‚Äî add photo to album (protected)
- DELETE `/api/photos/:id` ‚Äî delete photo (protected, ownership)

---

## 6. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

- –í —Ç–µ–∫—É—â–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏ –≤ –ø—Ä–æ–µ–∫—Ç–µ –Ω–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ç–µ—Å—Ç–æ–≤ (–Ω–µ—Ç `tests/` –∏–ª–∏ `__tests__` –∫–∞—Ç–∞–ª–æ–≥–∞).
- –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–æ–±–∞–≤–∏—Ç—å unit/integration —Ç–µ—Å—Ç—ã (Jest + Supertest) –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏, CRUD –∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞.

---

## 7. –ó–∞–ø—É—Å–∫ –ø—Ä–æ–µ–∫—Ç–∞

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
npm install
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ `.env`

–°–∫–æ–ø–∏—Ä—É–π—Ç–µ `.env.example` -> `.env` –∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø–æ–¥—Ö–æ–¥—è—â–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:

```env
DATABASE_URL="postgresql://postgres:password@localhost:5432/gallery_db?schema=public"
JWT_SECRET=your_very_long_and_secure_secret_key_here_change_it
```

### –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ë–î –∏ seed

```bash
npm run migrate
npm run seed
```

### –ó–∞–ø—É—Å–∫

```bash
npm run dev    # —Å nodemon
npm start      # production
```

---

## 8. –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –∏ –≤–æ–∑–º–æ–∂–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è üîß

- –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—É—é –≤–∞–ª–∏–¥–∞—Ü–∏—é –∑–∞–ø—Ä–æ—Å–æ–≤ (Joi –∏–ª–∏ express-validator).
- –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å refresh token flow –∏ logout.
- –î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç—ã (Jest + Supertest) –¥–ª—è –æ—Å–Ω–æ–≤–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤.
- –î–æ–±–∞–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é Swagger/OpenAPI –∏ —Å–∫—Ä–∏–Ω—à–æ—Ç—ã –¥–ª—è –æ—Ç—á—ë—Ç–∞.
- –ü–æ–¥—É–º–∞—Ç—å –æ –∑–∞–≥—Ä—É–∑–∫–µ —Ñ–∞–π–ª–æ–≤ (–Ω–∞–ø—Ä., –ª–æ–∫–∞–ª—å–Ω–æ–µ/–æ–±–ª–∞—á–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ) –≤–º–µ—Å—Ç–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ç–æ–ª—å–∫–æ URL.
- –£–ª—É—á—à–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫ –∏ —Ñ–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–æ–≤ (–µ–¥–∏–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç success/error).

---

## 9. –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- Seed-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: `test@example.com` / `password123` (—Å–æ–∑–¥–∞—ë—Ç—Å—è —á–µ—Ä–µ–∑ `prisma/seed.js`).
- –ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ, –º–æ–≥—É –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–∏—Ç—å:
  - Swagger –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é, –ø—Ä–∏–º–µ—Ä `doc/img` —Å–∫—Ä–∏–Ω—à–æ—Ç–æ–≤,
  - –ë–∞–∑–æ–≤—ã–µ —Ç–µ—Å—Ç—ã (auth + albums) –∏ CI script,
  - Password-reset flow –∏ refresh tokens.
