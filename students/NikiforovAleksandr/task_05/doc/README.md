# Лабораторная работа №05. Серверное REST API на Node.js + Express

**Вариант №16:** API спортивных лиг и матчей

## Цель работы

- Создание REST API для ресурса на Express с валидацией входных данных.
- Реализация централизованной обработки ошибок.
- Генерация документации OpenAPI/Swagger UI.
- Временное хранение данных в памяти приложения.

## Ход выполнения работы

### 1. Структура проекта

- `doc/README.md` — инструкция по запуску и документация.
- `src/app.js` — конфигурация Express приложения и middleware.
- `src/server.js` — точка входа, запуск сервера.
- `src/controllers/leagues.controller.js` — бизнес-логика для лиг.
- `src/controllers/matches.controller.js` — бизнес-логика для матчей.
- `src/routes/leagues.routes.js` — маршруты API для лиг.
- `src/routes/matches.routes.js` — маршруты API для матчей.
- `src/middlewares/error.middleware.js` — централизованная обработка ошибок.
- `src/middlewares/validate.middleware.js` — middleware для валидации данных.
- `src/validators/league.schema.js` — схемы валидации лиг с использованием Zod.
- `src/validators/match.schema.js` — схемы валидации матчей с использованием Zod.
- `src/docs/swagger.js` — конфигурация Swagger.
- `src/data/store.js` — временное хранилище данных в памяти.
- `package.json` — конфигурация npm-проекта и зависимости.
- `.env.example` — пример переменных окружения.
- `.gitignore` — исключения для Git.

### 2. Реализованные функции

#### 2.1 Базовая структура Express

- Настроен npm-проект с скриптами `dev` / `start`.
- Подключены middleware: `express.json()`, `cors`, `morgan`.
- Сервер запускается на порту из `.env` (по умолчанию 3000).
- Версионирование API: `/api/v1`.

#### 2.2 REST API для ресурсов "leagues" и "matches"

| Метод  | URL                       | Описание                  |
|--------|---------------------------|---------------------------|
| GET    | /api/v1/leagues           | Получить список всех лиг  |
| GET    | /api/v1/leagues/:id       | Получить лигу по ID       |
| POST   | /api/v1/leagues           | Создать новую лигу        |
| PATCH  | /api/v1/leagues/:id       | Обновить лигу (частично)  |
| DELETE | /api/v1/leagues/:id       | Удалить лигу              |
| GET    | /api/v1/matches           | Получить матчи            |
| GET    | /api/v1/matches/:id       | Получить матч по ID       |
| POST   | /api/v1/matches           | Создать новый матч        |
| PATCH  | /api/v1/matches/:id       | Обновить матч (частично)  |
| DELETE | /api/v1/matches/:id       | Удалить матч              |

#### 2.3 Валидация данных

**Лига:**

- `name`: строка 1–100 символов.
- `country`: строка 1–100 символов.

**Матч:**

- `leagueId`: UUID (проверяется существование лиги).
- `homeTeam`: строка 1–100 символов.
- `awayTeam`: строка 1–100 символов.
- `date`: строка в формате ISO datetime.
- `finished`: boolean.

#### 2.4 Обработка ошибок

- Централизованный error handler.
- Кастомный класс `ApiError`.
- Корректные HTTP статус-коды: 200, 201, 204, 404, 422, 500.
- Понятные сообщения об ошибках без утечки стека.

#### 2.5 Документация Swagger

- Автоматическая генерация документации из JSDoc-комментариев.
- Swagger UI доступен по адресу `/docs`.
- Полное описание всех эндпоинтов, параметров, схем и ответов.

### 3. Запуск проекта

#### 3.1 Установка зависимостей

Откройте проект в VSCode и выполните:

```bash
npm install
````

#### 3.2 Запуск сервера

- В режиме разработки:

```bash
npm run dev
```

- В продакшен-режиме:

```bash
npm start
```

Сервер запустится по адресу:

```text
http://localhost:3000
```

#### 3.3 Документация Swagger

После запуска сервера откройте:

```text
http://localhost:3000/docs
```

Swagger UI позволяет интерактивно тестировать все эндпоинты API.

### 4. Примеры запросов

***Создание лиги (POST /api/v1/leagues)***

```json
{
  "name": "Premier League",
  "country": "England"
}
```

***Создание матча (POST /api/v1/matches)***

```json
{
  "leagueId": "a1b2c3d4-e5f6-7890-g1h2-i3j4k5l6m7n8",
  "homeTeam": "Manchester United",
  "awayTeam": "Liverpool",
  "date": "2025-12-20T15:00:00.000Z",
  "finished": false
}
```

### 5. HTTP Статус-коды

| Статус | Описание                  |
| ------ | ------------------------- |
| 200    | Успешный запрос           |
| 201    | Ресурс создан             |
| 204    | Ресурс удалён             |
| 400    | Неверный запрос           |
| 404    | Ресурс не найден          |
| 422    | Ошибка валидации          |
| 500    | Внутренняя ошибка сервера |

## Вывод

Разработано REST API для управления спортивными лигами и матчами с использованием Node.js и Express.

- Реализованы все CRUD-операции.
- Настроена валидация входных данных с Zod.
- Реализована централизованная обработка ошибок.
- Автоматическая генерация документации через Swagger.
- API возвращает корректные HTTP статус-коды и понятные сообщения об ошибках.
- Дополнительно реализованы пагинация матчей и версионирование маршрутов.
